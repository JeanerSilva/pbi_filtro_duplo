var filtroHierarquico123456;(()=>{"use strict";var e={111:(e,t,i)=>{i.r(t)},473:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VisualSettings=void 0;var i=function(){function e(){this.behavior_selectionMode=!0,this.behavior_forceSelection=!0,this.behavior_leafOnly=!0,this.formatting_fontSize=12,this.formatting_itemPadding=4,this.formatting_fontFamily="DIN, Segoe UI, Arial, sans-serif",this.formatting_fontColor="#222222",this.formatting_fontBold=!1,this.formatting_fontItalic=!1,this.formatting_fontUnderline=!1,this.search_enabled=!0,this.search_placeholder="Pesquisar...",this.search_fontSize=15}return e.parse=function(t){var i=new e,s=t&&t.metadata&&(t.metadata.objects||{});return i.formatting_fontSize=o(s,"formatting","fontSize",i.formatting_fontSize),i.formatting_itemPadding=o(s,"formatting","itemPadding",i.formatting_itemPadding),i.formatting_fontFamily=a(s,"formatting","fontFamily",i.formatting_fontFamily),i.formatting_fontColor=function(e,t,i,n){var o=r(e,"formatting"),a=o&&o.fontColor,s=a&&a.solid&&a.solid.color;return"string"==typeof s&&s?s:n}(s,0,0,i.formatting_fontColor),i.formatting_fontBold=n(s,"formatting","fontBold",i.formatting_fontBold),i.formatting_fontItalic=n(s,"formatting","fontItalic",i.formatting_fontItalic),i.formatting_fontUnderline=n(s,"formatting","fontUnderline",i.formatting_fontUnderline),i.behavior_selectionMode=n(s,"behavior","selectionMode",i.behavior_selectionMode),i.behavior_forceSelection=n(s,"behavior","forceSelection",i.behavior_forceSelection),i.behavior_leafOnly=n(s,"behavior","leafOnly",i.behavior_leafOnly),i.formatting_fontSize=o(s,"formatting","fontSize",i.formatting_fontSize),i.formatting_itemPadding=o(s,"formatting","itemPadding",i.formatting_itemPadding),i.search_enabled=n(s,"search","enabled",i.search_enabled),i.search_placeholder=a(s,"search","placeholder",i.search_placeholder),i.search_fontSize=o(s,"search","fontSize",i.search_fontSize),i},e}();function r(e,t){return e&&e[t]?e[t]:{}}function n(e,t,i,n){var o=r(e,t);return"boolean"==typeof o[i]?o[i]:n}function o(e,t,i,n){var o=r(e,t);return"number"==typeof o[i]?o[i]:n}function a(e,t,i,n){var o=r(e,t);return"string"==typeof o[i]?o[i]:n}t.VisualSettings=i},848:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Visual=void 0,i(111);var r=i(473),n=function(){function e(e){var t=this;this.settings=new r.VisualSettings,this.categoryColumns=[],this.targets=[],this.rootNode=null,this.levelsCount=0,this.searchQuery="",this.lastSignature="",this.activeSelectionLevel=null,this.root=document.createElement("div"),this.root.className="filtro-conjugado";var i=document.createElement("div");i.className="search-bar";var n=document.createElement("div");n.className="search-input-wrap",this.searchInput=document.createElement("input"),this.searchInput.className="search-input",this.searchInput.type="text",this.searchInput.placeholder="Pesquisar...",this.searchClear=document.createElement("div"),this.searchClear.className="search-clear",this.searchClear.textContent="X",this.searchClear.title="Limpar",n.appendChild(this.searchInput),n.appendChild(this.searchClear),i.appendChild(n),this.searchBar=i,this.listContainer=document.createElement("div"),this.listContainer.className="list-container",this.treeRootEl=document.createElement("ul"),this.treeRootEl.className="tree",this.listContainer.appendChild(this.treeRootEl),this.root.appendChild(this.searchBar),this.root.appendChild(this.listContainer),this.host={applyJsonFilter:function(){}},e&&(this.host=e.host,e.element.appendChild(this.root)),this.searchInput.addEventListener("input",function(){t.searchQuery=(t.searchInput.value||"").toLowerCase(),t.renderTree()}),this.searchClear.addEventListener("click",function(){t.searchQuery="",t.searchInput.value="",t.renderTree()})}return e.prototype.update=function(e){var t=e.dataViews&&e.dataViews[0];t&&(this.settings=r.VisualSettings.parse(t)),this.applySearchBarSettings();var i=null==t?void 0:t.categorical,n=i&&i.categories?i.categories:[];this.categoryColumns=[];for(var o=0;o<n.length;o++)n[o]&&n[o].values&&n[o].values.length>0&&this.categoryColumns.push(n[o]);if(this.levelsCount=this.categoryColumns.length,0===this.levelsCount)return this.rootNode=null,this.targets=[],this.lastSignature="",this.activeSelectionLevel=null,void this.renderTree();this.targets=new Array(this.levelsCount);for(var a=0;a<this.levelsCount;a++)this.targets[a]=this.extractTargetFromMetadata(this.categoryColumns[a]);if(this.rebuildTree(),this.settings.behavior_selectionMode&&this.settings.behavior_forceSelection&&!this.anySelected(this.rootNode)){var s=this.findFirstLeaf(this.rootNode);s&&(this.clearAllSelections(this.rootNode),s.selected=!0,this.activeSelectionLevel=s.level,this.applyBasicFilterForLevel(s.level))}this.renderTree()},e.prototype.rebuildTree=function(){for(var e=String(this.levelsCount)+"|",t=(this.categoryColumns[0].values.length,0);t<this.levelsCount;t++)e+="L"+t+":"+(this.categoryColumns[t].values||[]).length+"|";for(var i={key:"__root__",label:"",level:-1,expanded:!0,selected:!1,children:[],parent:null,isLeaf:!1},r=this.categoryColumns[0].values.length,n=0;n<r;n++){var o=i;for(t=0;t<this.levelsCount;t++){var a=this.categoryColumns[t].values[n],s=null==a?"":String(a),l=this.findChild(o,s);l||(l={key:s,label:s,level:t,expanded:t<this.levelsCount-1,selected:!1,children:[],parent:o,isLeaf:t===this.levelsCount-1},o.children.push(l)),o=l}}if(this.rootNode){var c=this.collectSelectedByPath(this.rootNode);c.length>0&&this.restoreSelectionByPath(i,c)}this.rootNode=i,this.lastSignature=e},e.prototype.findChild=function(e,t){for(var i=0;i<e.children.length;i++)if(e.children[i].key===t)return e.children[i];return null},e.prototype.collectSelectedByPath=function(e){var t=[];return e?(this.walk(e,[],function(e,i){if(e.selected){var r=i.concat([e.label]);t.push(r.slice(1))}}),t):t},e.prototype.restoreSelectionByPath=function(e,t){for(var i=0;i<t.length;i++){for(var r=t[i],n=e,o=0;o<r.length&&n;o++){var a=this.findChild(n,r[o]);if(!a){n=null;break}n=a}n&&(n.selected=!0)}},e.prototype.renderTree=function(){for(var e=this;this.treeRootEl.firstChild;)this.treeRootEl.removeChild(this.treeRootEl.firstChild);if(!this.rootNode||0===this.rootNode.children.length){var t=document.createElement("li");return t.className="node",t.textContent="Sem itens",void this.treeRootEl.appendChild(t)}var i=Math.max(8,Number(this.settings.formatting_fontSize)||15),r=Math.max(0,Number(this.settings.formatting_itemPadding)||0),n=!!this.settings.behavior_selectionMode,o=!!this.settings.behavior_leafOnly,a=function(t,s,l){if(t.level>=0){if(!e.matchesSearch(t)&&!e.descendantMatchesSearch(t))return;var c=document.createElement("li"),h=document.createElement("div"),d=t.selected&&(!o||t.isLeaf);h.className="node"+(d?" selected":""),h.style.paddingLeft=14*l+2+"px",h.style.fontSize=i+"px",h.style.paddingTop=r+"px",h.style.paddingBottom=r+"px",h.style.fontFamily=e.settings.formatting_fontFamily,h.style.color=e.settings.formatting_fontColor,h.style.fontWeight=e.settings.formatting_fontBold?"600":"400",h.style.fontStyle=e.settings.formatting_fontItalic?"italic":"normal",h.style.textDecoration=e.settings.formatting_fontUnderline?"underline":"none";var u=document.createElement("span");u.className="toggle",u.textContent=t.isLeaf?"":t.expanded?"▼":"▶",u.addEventListener("click",function(i){i.stopPropagation(),t.isLeaf||(t.expanded=!t.expanded,e.renderTree())});var f=void 0;if(!o||t.isLeaf){var p=document.createElement("input");p.type=n?"radio":"checkbox",p.checked=t.selected,n&&(p.name="visual-selection-group"),p.addEventListener("click",function(i){i.stopPropagation(),e.onNodeClick(t,n,o)}),f=p}else{var g=document.createElement("span");g.style.display="inline-block",g.style.width="14px",g.style.height="14px",f=g}var v=document.createElement("span");if(v.className="label",v.textContent=t.label,h.addEventListener("mousedown",function(e){0===e.button&&e.preventDefault()}),h.addEventListener("click",function(i){0===i.button&&e.onNodeClick(t,n,o)}),h.appendChild(u),h.appendChild(f),h.appendChild(v),c.appendChild(h),s.appendChild(c),!t.isLeaf&&t.expanded){var m=document.createElement("ul");m.className="children",c.appendChild(m);for(var y=0;y<t.children.length;y++)a(t.children[y],m,l+1)}}else for(y=0;y<t.children.length;y++)a(t.children[y],s,0)};a(this.rootNode,this.treeRootEl,0)},e.prototype.onNodeClick=function(e,t,i){if(i&&!e.isLeaf)return e.expanded=!e.expanded,void this.renderTree();var r=e.level;this.activeSelectionLevel=r,t?(this.clearAllSelections(this.rootNode),e.selected=!0):(this.clearSelectionsExceptLevel(this.rootNode,r),e.selected=!e.selected),this.renderTree(),this.applyBasicFilterForLevel(r)},e.prototype.clearAllSelections=function(e){e&&this.walk(e,[],function(e){e.selected=!1})},e.prototype.clearSelectionsExceptLevel=function(e,t){e&&this.walk(e,[],function(e){e.level!==t&&(e.selected=!1)})},e.prototype.anySelected=function(e){var t=!1;return this.walk(e,[],function(e){e.selected&&(t=!0)}),t},e.prototype.findFirstLeaf=function(e){if(!e)return null;if(e.isLeaf&&e.level>=0)return e;for(var t=0;t<e.children.length;t++){var i=this.findFirstLeaf(e.children[t]);if(i)return i}return null},e.prototype.applyBasicFilterForLevel=function(e){var t=this.targets[e];if(t){var i=[];if(this.walk(this.rootNode,[],function(t){t.level===e&&t.selected&&i.push(t.label)}),0!==i.length){var r={$schema:"http://powerbi.com/product/schema#basic",filterType:1,operator:"In",target:{table:t.table,column:t.column},values:i};this.host.applyJsonFilter(r,"general","filter",0)}else this.host.applyJsonFilter(null,"general","filter",2)}},e.prototype.extractTargetFromMetadata=function(e){var t,i,r,n,o=null===(t=e.source)||void 0===t?void 0:t.expr;try{var a=o&&(o.ref||o.level||o.source&&o.source.ref)||(null===(i=e.source)||void 0===i?void 0:i.groupName),s=o&&o.source&&o.source.entity||o&&o.arg&&o.arg.source&&o.arg.source.entity||o&&o.arg&&o.arg.arg&&o.arg.arg.entity;if(s&&a)return{table:String(s),column:String(a)}}catch(e){}var l=null===(r=e.source)||void 0===r?void 0:r.queryName;if(l&&"string"==typeof l){var c=l.lastIndexOf(".");if(c>0&&c<l.length-1)return{table:l.substring(0,c),column:l.substring(c+1)}}return(null===(n=e.source)||void 0===n?void 0:n.displayName)?{table:"",column:e.source.displayName}:null},e.prototype.applySearchBarSettings=function(){var e=!!this.settings.search_enabled;this.searchBar.style.display=e?"flex":"none",this.searchInput.placeholder=this.settings.search_placeholder||"Pesquisar...";var t=Math.max(8,Number(this.settings.search_fontSize)||15);this.searchInput.style.fontSize=t+"px"},e.prototype.matchesSearch=function(e){var t=this.searchQuery;return!t||-1!==(e.label||"").toLowerCase().indexOf(t)},e.prototype.descendantMatchesSearch=function(e){if(!this.searchQuery)return!0;for(var t=0;t<e.children.length;t++){var i=e.children[t];if(this.matchesSearch(i)||this.descendantMatchesSearch(i))return!0}return!1},e.prototype.walk=function(e,t,i){if(e){i(e,t);for(var r=0;r<e.children.length;r++)this.walk(e.children[r],t.concat([e.label]),i)}},e.prototype.enumerateObjectInstances=function(e){var t=[];return"behavior"===e.objectName&&t.push({objectName:"behavior",properties:{selectionMode:this.settings.behavior_selectionMode,forceSelection:this.settings.behavior_forceSelection,leafOnly:this.settings.behavior_leafOnly},selector:{}}),"formatting"===e.objectName&&t.push({objectName:"formatting",properties:{fontSize:this.settings.formatting_fontSize,itemPadding:this.settings.formatting_itemPadding},selector:{}}),"search"===e.objectName&&t.push({objectName:"search",properties:{enabled:this.settings.search_enabled,placeholder:this.settings.search_placeholder,fontSize:this.settings.search_fontSize},selector:{}}),t},e}();t.Visual=n}},t={};function i(r){var n=t[r];if(void 0!==n)return n.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,i),o.exports}i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{var e=r;Object.defineProperty(e,"__esModule",{value:!0});var t=i(848),n=window.powerbi,o={name:"filtroHierarquico123456",displayName:"Filtro Hierárquico que permite mais de um por tela.",class:"Visual",apiVersion:"5.11.0",create:function(e){if(t.Visual)return new t.Visual(e);throw"Visual instance not found"},createModalDialog:function(e,t,i){var r=globalThis.dialogRegistry;e in r&&new r[e](t,i)},custom:!0};void 0!==n&&(n.visuals=n.visuals||{},n.visuals.plugins=n.visuals.plugins||{},n.visuals.plugins.filtroHierarquico123456=o),e.default=o})(),filtroHierarquico123456=r})();